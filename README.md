# rbitcoin
a rust client for bitcoin


# 如何从0设计一个bitcoin系统，设计的权衡和决策时什么？
>>## 1,什么是bitcoin?
        一个点对点的电子货币系统。
        
>>## 2，电子货币是什么？
        电子货币是一种储存在计算机中，可以随网络流通的货币。是纸币的替代品。
        
>>## 3，那么如何实现电子货币？
        计算机可以储存数据，但是计算机的数据容易被修改。
        如果让数据不容易被修改，那么就等同于制作一个现实世界的账本了。
        账本可以记录任何东西，包括数字。
        如果一种数字(btc,erc20)被大家认可是存在价值，并且数量可以被证明所有权，可以记录在账本中，那么就可以作为货币来用。
        
>>## 4，如何让数据不容易被修改？
    4.1 在计算机领域，数据可以不容被修改吗？
        不可能，做不到。单独设计硬件也许可以。
    4.2 那么退求其次，计算机可以检测数据是否被修改过吗？
        这是可以的，在计算机领域，我们很容易想到hash函数。
所以我们可以通过hash函数，检测出被修改的数据。将这些别修改的数据剔除（或者不承认），那么就是不可以篡改的数据。

>>## 5，以上只是是个人可以相信的账本，价值不大。那么如何可以让所有人相信呢？
        所有人都持有一份个人可以相信的账本，那么所有人就相信这个账本了。

>>## 6，从技术上如何实现，账本如何传输？
        账本通过网络传输。
        6.1 账本网络传输如何设计，从一个中心的服务器下载账本可以吗？
                6.1.1 可行，但是存在缺陷。
                        6.1.1.1 容易单点故障。
                        6.1.1.3 账本容易被控制和篡改。
        6.2 所以去中心化，比中心化更好，那么如何实现一个去中心化的账本？
                p2p协议，p2p网络是去中心化的，从p2p网络下载账本，可以解决账本安全问题。

>>## 7，至此已经实现了一个所有人都可信的账本记录，但是无法增加记录，那么如何增加记录，也就是如何记账？
        7.1，记录从何而来？
                所有人可以写记录，并提交到bitcoin网络中。
        7.2，记录如何确定有效？
                通过规则验证，即为有效。
        7.3，谁有资格记账，如何确定谁来记账？
                所有人都有资格记账。所有人通过一个公平合理的规则选出的人来记账。

>>## 8，记账的人我们确定了，我们把记账的群体称为矿工，那么如何矿工如何同步记录，并且更新记录？
        8.1，如果每次记录更新，都传输整个账本，并且记录上hash，会出现什么状态？
                网络不支持，数据越来越大，网络迟早崩溃。账本无法同步。
        8.2，退求其次，不传输整个账本了？
                只传输更新了的数据。这样缩减了大量的数据，降低了网络的压力。同时带来了新的问题，增加了系统的复杂性。
        8.3，如果只传输更新的一条记录，那么存在的问题是什么？
                8.3.1，计算机资源浪费，一条记录就要计算一条hash。
                8.3.2，全网账本不统一，出现大量分叉。
        8.4，那么传输特定数量的记录就是一个折中方案，这个数量是多少呢？
                我们把这个特定数量的记录称为区块。而这个区块的大小被限定为1M。
  
>>## 9，记录如何更新解决了，那么新的问题出现了，我们用了区块这个概念，那么整个账本如何确定不可篡改呢？
    这个非常容易，从第一个块开始，每个块记录前一个块hash。
    只要验证所有的hash,并且就可以知道账本的真实性，那么账本就是不可篡改的。
    我们把这种链式结构，称为区块链。

>>## 10，区块的大小被限定为1M,每次都需要满足1M的记录，才能被记录到账本上，是否合理，如果不合理，如何解决？
    不合理，我发起一笔转账，我不知道我需要等多久，状态才可以被确定。
    这样效率太低，并且不方便。
    所以需要通过限定一个时间，时间到了，区块必须生成，而不是满足1M的区块大小来。
    在bitcoin中，这个时间是10分钟。

>>## 11，如何选择这个更新区块的人，并且如何防止作恶？
    11.1，一个公平的游戏规则。
    11.2，为了防止作恶，就需要需要付出成本，同时获取到系统的奖励，激励记账。
        所以bitcoin，就通过计算hash，来确定记账权利。
        第一个计算出特定hash的，即拥有记账权利。计算hash，需要付出算力成本。
    11.3，为什么这么设定记账规则？
        确保公平，确保所有人都可以相信这个账本，而不只是少数人可以篡改，并且只有少数人可以相信。

>>## 12, 到目前为止，只需要设定合理的记账规则，那么这个系统就是合理的？
    只要记账规则合理，就不会存在双花之类的问题。这些都是记账层面的问题，而不是整个bitcoin 系统的问题。

>>## 13，记录（交易）的设计（转账）。
    13.1，如何确定个人身份，在计算机中？
        计算机签名。密码学。非对称加密体系。

    13.2，utxo存在的意义？
        存在的作用，可以用来验证交易有效。防止了签名重复有效。
        同时引入了脚本系统，扩大了bitcoin的可扩展性和适用性。
        逻辑简单，方便验证，最大程度的增加系统的可靠性。

    13.3，merkle tree是否有必要？
        13.3.1 把交易全部打包到区块里，编号，按顺序，怎么样？
                是可行的。
                区块同步的时候有问题，数据太大了,如果发现链同步错了，重新同步，就炸了。
                对整个网络是不小了压力。
        13.3.2 那么是不是有办法，把传输数据的量给降低。区块减小，或者压缩区块？
                第一种办法，是否可以把区块压缩，是可以的,zk-snark是ok的。--mina。
                第二种办法，有没有办法减小区块的内容。不行，所有数据必然记录。
                      13.3.2.1  那么是不是有办法解决同步问题，减小需要同步的数据？
                                有，我们在同步时，把所有交易不同步，只同步区块头。
                                而区块头我们可以只记录一条hash。类似于区块链结构，不记录所有的交易记录，
        13.3.3 那么有是否可以改进这个线性结构？
                可以，把这个结构改成树形结构，提高了效率。merkle tree来自于这里。
        13.3.4 这样的好处是什么呢？
                同步区块头，就可以知道一条链是不是正确的。
                极大的减小了网络的压力。
                并且使资源有限的设备使用成为可能，轻节点来源于这里。
                轻节点可以资源有限的环境里，验证交易。

>> 14 区块链的本质是个状态机，分布式系统和并行系统面临的同一个本质都是状态改变的顺序问题，也就是时间问题。问题的根源是计算机无法模拟时间。那么在模拟现实的时候就会出现问题，目前有两种方式解决？

        14.1 第一种解决方式，是提供一个原子时钟，给状态操作提供顺序标记。（google 公司解决方案）

        14.2 第二种解决方式，就是分布式系统共识问题，所有的系统对状态转换操作的顺序(交易顺序)(事件发生的时间顺序)形成一个共识，把多个交易组装成一个区块，一个区块被创造的过程，这个过程在以太坊黄皮书被称为定稿函数。而形成共识的方式的方法，有多种。(区块链从某种意义上来说，是一个时钟)
                14.2.1 在可信环境下？
                        raft 共识 （分布式数据库）
                14.2.2 在拜占庭环境下，不可信环境下？ 
                        概率性共识
                                pow 共识（bitcoin）
                        确定性共识
                                pos 共识 (polkadot),bpfs(platon)。

### 至此，整个bitcion系统已经是可行的了。

# 额外改进
## 1，提出脚本系统,脚本系统如何设计？
        1.1 作用是什么？
                让合法交易的可能性更多。
                让交易规则可以自由组合。
                提供设计特殊的交易的可能。
        1.2 规则是什么？
                可以被验证结果的，全网所有节点可以这个结果达成一致的计算过程。比如push，pop。
                规则可以自由组合和叠加。所有规则自由组合成一笔可以被验证的交易，那么合法交易的可能性就可以更多了。
                可以组合规则，设计出符合自己需求的交易。
## 2，提出address的概念，bech58编码，如何设计？
## 3, 所有人如何成为对等节点，无需依赖中心，如何设计?
        p2p协议，bitcoin采用了gossip协议。
